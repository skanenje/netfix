{% extends 'main/base.html' %}
{% load static %}

{% block title %}Create Service{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/registration.css' %}">
<div class="registration-page">
    <div class="register-container">
        <div class="register-header">
            <div class="logo">
                <div class="logo-icon">N</div>
                <span>NetFix</span>
            </div>
            <h1 class="register-title">Create New Service</h1>
            <p class="register-subtitle">Add a service to your offerings</p>
        </div>

        <form class="register-form" method="post" id="serviceForm" novalidate>
            {% csrf_token %}

            <!-- Display general form errors -->
            {% if form.non_field_errors %}
            <div class="form-errors">
                {{ form.non_field_errors }}
            </div>
            {% endif %}

            <div class="form-fields">
                <div class="form-group">
                    <label for="{{ form.name.id_for_label }}">Service Name</label>
                    {{ form.name }}
                    {% if form.name.errors %}
                    <div class="error-message">{{ form.name.errors.0 }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.description.id_for_label }}">Description</label>
                    {{ form.description }}
                    {% if form.description.errors %}
                    <div class="error-message">{{ form.description.errors.0 }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.price_per_hour.id_for_label }}">Price per Hour (KES)</label>
                    {{ form.price_per_hour }}
                    {% if form.price_per_hour.errors %}
                    <div class="error-message">{{ form.price_per_hour.errors.0 }}</div>
                    {% endif %}
                </div>

                {% if form.field.widget.input_type != 'hidden' %}
                <div class="form-group">
                    <label for="{{ form.field.id_for_label }}">Service Category</label>
                    {{ form.field }}
                    {% if form.field.errors %}
                    <div class="error-message">{{ form.field.errors.0 }}</div>
                    {% endif %}
                </div>
                {% else %}
                {{ form.field }}
                {% endif %}
            </div>

            <button type="submit" class="submit-btn">Create Service</button>

            <div class="login-link">
                <a href="{% url 'services:services_list' %}">‚Üê Back to Services</a>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('serviceForm');

        if (form) {
            // Add client-side validation
            form.addEventListener('submit', function (e) {
                let isValid = true;

                // Clear previous errors
                document.querySelectorAll('.error-message').forEach(el => {
                    if (!el.textContent.trim()) {
                        el.style.display = 'none';
                    }
                });
                document.querySelectorAll('input, select, textarea').forEach(el => {
                    el.classList.remove('error');
                });

                // Validate required fields
                const nameField = document.querySelector('input[name="name"]');
                const descriptionField = document.querySelector('textarea[name="description"]');
                const priceField = document.querySelector('input[name="price_per_hour"]');
                const fieldSelect = document.querySelector('select[name="field"]');

                if (nameField && !nameField.value.trim()) {
                    showFieldError(nameField, 'Service name is required');
                    isValid = false;
                }

                if (descriptionField && !descriptionField.value.trim()) {
                    showFieldError(descriptionField, 'Description is required');
                    isValid = false;
                }

                if (priceField) {
                    const price = parseFloat(priceField.value);
                    if (!priceField.value.trim()) {
                        showFieldError(priceField, 'Price per hour is required');
                        isValid = false;
                    } else if (isNaN(price) || price <= 0) {
                        showFieldError(priceField, 'Price must be a positive number');
                        isValid = false;
                    }
                }

                if (fieldSelect && fieldSelect.style.display !== 'none' && !fieldSelect.value) {
                    showFieldError(fieldSelect, 'Service category is required');
                    isValid = false;
                }

                if (!isValid) {
                    e.preventDefault();
                }
            });
        }

        function showFieldError(field, message) {
            field.classList.add('error');

            let errorElement = field.parentNode.querySelector('.error-message');
            if (!errorElement) {
                errorElement = document.createElement('div');
                errorElement.className = 'error-message';
                field.parentNode.appendChild(errorElement);
            }

            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }
    });
</script>
{% endblock %}